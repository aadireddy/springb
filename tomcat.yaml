- name: tomcat installation
  hosts: webservers
  become: true
  tasks:
  - name: install JDK 8
    yum: name=java-1.8.0-openjdk state=present
  - name: add tomcat group
    group:
      name: tomcat
  - name: add tomcat users
    user:
      name: tomcat
      group: tomcat
      home: /user/share/tomcat
      createhome: no
  - name: create /opt/tomcat dir
    file:
      path: /opt/tomcat
      state: directory
      mode: 0755
  - name: download and untar tomcat
    unarchive:
      src: https://apachemirror.wuchna.com/tomcat/tomcat-10/v10.0.7/bin/apache-tomcat-10.0.7.tar.gz
      dest: /opt/tomcat/
      copy: no
  - name: copy users
    template:
      src: tomcat-users.xml
      dest: /opt/apache-tomcat-10.0.7/conf/tomcat-user.xml
  - name: copy content.xml
    template:
      src: content.xml
      dest: /opt/apache-tomcat-10.0.7/webapps/manager/META-INF/content.xml
  - name: shutdown tomcat
    command: nohup sh /opt/apache-tomcat-10.0.7/bin/shutdown.sh &
    become: true
    become_user: root
  - name: start tomcat
    command: nohup sh /opt/apache-tomcat-10.0.7/bin/startup.sh &
    become: true
    become_user: root
